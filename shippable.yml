build_image: chetantarale/u14php7pls:testext1

language: 
  - php

php:
  - '7.0'

services:
  - memcached

before_script: 
  - currentLocation="$PWD"
  - apt-get install memcached
  - /etc/init.d/memcached start
  - /etc/init.d/memcached status
  - find / -name memcached.so
  - find / -name memcached.ini
  - echo "extension=memcached.so" > /etc/php/7.0/mods-available/memcached.ini
  - sudo ln -s /etc/php/mods-available/memcached.ini /etc/php/7.0/fpm/conf.d/20-memcached.ini
  - sudo ln -s /etc/php/mods-available/memcached.ini /etc/php/7.0/cli/conf.d/20-memcached.ini
  # Reload php-fpm to include the new changes
  - sudo service php7.0-fpm restart
  - sudo service redis-server restart
  - mkdir -p shippable/testresults
  - mkdir -p shippable/codecoverage
  - wget https://phar.phpunit.de/phpunit.phar
  - chmod +x phpunit.phar
  - sudo mv phpunit.phar /usr/local/bin/phpunit
  - phpunit --version
  - cd "$currentLocation"
script:
  - phpunit  --log-junit shippable/testresults/junit.xml --coverage-xml shippable/codecoverage tests/MemcachedExampleTest.php
